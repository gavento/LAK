\subsection{Charakterizace perfektních kódů}
Pro každý kód $C$ opravující $t$ chyb platí nerovnost
\[
|C| \leq { q^n \over \sum\limits_{i=0}^t \binom{n}{i} (q-1)^i },
\]
označována také jako Sphere packing (dokázaná na začátku sekce). Pro perfektní kódy pak platí rovnost. Než se pustíme do charakterizace perfektních kódů nad abecedou velikosti mocniny prvočísla, dokážeme nutnou podmínku pro existenci takovýchto kódů.

\vt Nechť $q=p^r$, kde $p$ je prvočíslo. Pak existuje $\alpha \in \N$ takové, že
\[
\sum\limits_{i=0}^t \binom{n}{i} (q-1)^i = q^\alpha.
\]

\dk Ze Sphere packingu dostaneme
\begin{align}
\sum\limits_{i=0}^t \binom{n}{i} (q-1)^i = { q^n \over |C| }. \label{eq:PrimeCodeSize}
\end{align}
Tedy, $|C|$ musí dělit $q^n = p^{rn}$ a ${ q^n \over |C| } = p^\beta$ pro nějaké $\beta \in \N$. Dále použijeme následující rovnost (jednoduše dokazatelnou indukcí)
\begin{align}
\sum\limits_{i=0}^n \binom{n}{i} (q-1)^i = q^n. \label{eq:PowerOfq}
\end{align}
Když od sebe odečteme rovnice~\ref{eq:PowerOfq} a~\ref{eq:PrimeCodeSize}, dostaneme
\[
q^n - p^\beta \equiv 0 \text{ (mod } q - 1),
\]
z čehož vyplývá $p^\beta = q^\alpha$ pro nějaké $\alpha \in \N$. \qed


\vt Nechť $q=p^r$, a $p$ je prvočíslo. Pak existují právě následující netriviální perfektní kódy (tedy s $|C| \geq 2$ a pokud $|C| = 2$, tak to není kód $q=2$ a $n=2t+1$):
\begin{description}
	\item $1$-perfektní kód $n={q^k-1 \over q-1}$ pro libovolné $k$ a $q$ (Hammingův)
	\item $2$-perfektní kód $q=3$ a $n=11$ (Golayův)
	\item $3$-perfektní kód $q=2$ a $n=23$ (Golayův)
\end{description}


Důkaz je technicky náročný a budeme se jím zabývat po zbytek sekce. Po celou dobu budeme předpokládat, že $q$ je mocnina nějakého prvočísla. Základem je Lloydova věta a právě dokázaná nutná podmínka pro existenci těchto kódů. Nejprve se pro malé hodnoty parametrů ukáže, zda pro dané hodnoty kódy existují či nikoli. Pak se pro obecný případ udělá horní odhad parametrů pomocí Lloydovy věty. A pro konečný počet případů, pro které by kódy mohly existovat, bylo dokázáno počítačem, že neexistují.  Pro $t = 1$ ze Sphere packingu dostaneme $1 + n(q - 1) = q^\alpha$, tedy $n = \frac{q^\alpha - 1}{q - 1}$, což jsou přesně velikosti Hammingových kódů. Dále budeme předpokládat, že $t \geq 2$.

\vt $2$-perfektní kód existuje jen pro $q = 3$ (Golayův kód).

Důkaz neexistence $2$-perfektního kódu nad jinou než tří prvkovou abecedou uvedeme jen pro $q = 2$.

\vt Pro $q=2$ neexistuje $2$-perfektní kód.

\dk Z dokázané nutné podmínky pro existenci perfektního kódu dostaneme:
\begin{align}
	1 + n + {n \choose 2} &= q^\alpha  \\
	2 + 2n + n(n-1) &= q^{\alpha + 1} \label{eq:SpherePacking}\\
	7 + (2n + 1)^2 &=q^{\alpha + 3} \label{eq:SpherePacking2}
\end{align}

A dále pak z Lloydovy věty dostaneme:
\begin{align*}
L_2(x) &= {n - x \choose 2} - (x - 1)(n -x) + {x - 1 \choose 2} \\
2L_2(x) &= n^2 + n + 2 + 4x^2 - 2(n + 1)2x
\end{align*}

Provedeme substituci $y = 2x$ a za $n^2 + n + 2$ dosadíme $q^{\alpha + 1}$ (z rovnice~\ref{eq:SpherePacking}):
\begin{align*}
p(y) = y^2 - 2(n+1)y + 2^{\alpha + 1}
\end{align*}
Z Vietových vzorců dostaneme pro kořeny $y_1, y_2$ polynomu $p$:

\begin{align}
y_1y_2 &= 2^{\alpha + 1} \\
y_1 + y_2 &= 2n + 2 \label{eq:Viet}
\end{align}
Tedy $y_1 = 2^a, y_2 = 2^b$ pro nějaké $a,b \geq 0$, bez újmy na obecnosti $a \leq b$. Nyní rozebereme několik případů pro různé hodnoty $a$.

\begin{itemize}
\item[$a = 1$]
Tedy $y_1 = 2$ a $y_2 = 2n$. Po dosazení do polynomu $p$ dostaneme hodnoty $n = 1$ nebo $n = 2$, což jsou nesmyslné hodnoty pro kódy.
\item[$a = 2$]
Tedy $y_1 = 4$ a $y_2 = 2n -2$. Stejným způsobem jako v předchozím bodu dosadíme do $p$ a spočteme $n = 2$ nebo $n = 5$. Pro $n = 5$ dostaneme triviální opakovací kód.
\item[$a \geq 3$]
Z rovnice~\ref{eq:Viet} a faktu, že $a,b\geq 3$ dostaneme pro nějaké $k$:
\begin{align}
2n + 1 &= 2^a + 2^b - 1 \\
&= 8k - 1 \\
(2n + 1)^2 &= 64k^2 - 16k + 1 \label{eq:Mod1}
\end{align}

A dosadíme do rovnice~\ref{eq:SpherePacking2}:
\begin{align}
(2n + 1)^2 = 2^{\alpha + 3} - 7 \label{eq:Mod7}
\end{align}

Pravá strana rovnice~\ref{eq:Mod1} modulo 16 se rovná $1$, zatímco pravá strana rovnice~\ref{eq:Mod7} modulo 16 se rovná $-7$, což je spor, neboť by se pravé strany obou rovnic měly rovnat. Pro $a \geq 3$ tedy neexistuje žádný perfektní kód. \qed

\end{itemize}

\vt Pro $t \geq 3$ a $q > 2$ neexistuje $t$-perfektní kód nad abecedou s $q$ znaky.

Důkaz této části je nejnáročnější, proto ho rozdělíme do několika lemmátek. Hlavní roli budou mít kořeny Lloydova polynomu, které si označíme $\sigma_1, \dots, \sigma_t$ a pro které platí

\begin{align*}
2 < \sigma_1 < \dots < \sigma_t < n.
\end{align*}

Nerovnosti mezi kořeny máme z Lloydovy věty. Po dosazení čísel $0, 1$ a $2$ do Lloydova polynomu, zjistíme, že ani jedno z těchto čísel není kořenem, tedy $2 < \sigma_1$.

\lm Pro kořeny Lloyodova polynomu $\sigma_1, \dots, \sigma_t$ platí:
\begin{enumerate}
\item $\prod\limits_{i = 1}^{t} \sigma_i = t!q^{\alpha - t}$
\item $\sum\limits_{i = 1}^{t} \sigma_i = \frac{t(n-t)(q-1)}{q} + \frac{t(t+1)}{2}$
\end{enumerate}


\dk Nejprve si vyjádříme součin kořenů pomocí koeficientů Lloydova polynomu.
\begin{align*}
L_t(x) &= a_t x^t + \dots + a_1x + a_0 \\
&= a_t \Bigl(x^t + \frac{a_{t-1}}{a_t}x^{t-1} + \dots + \frac{a_0}{a_t}\Bigr) \\
&= a_t (x - \sigma_1)\dots(x - \sigma_t) \\
&= a_t\Bigl(x^t - \Bigl(\sum \sigma_i\Bigr)x^{t-1} + \dots + (-1)^t \prod \sigma_i\Bigr)
\end{align*}
Tedy máme:
\begin{align}
\prod\limits_{i = 1}^{t} \sigma_i = (-1)^t \frac{a_0}{a_t} \label{eq:ProdRoot} \\
\sum\limits_{i = 1}^{t} \sigma_i = -1 \frac{a_{t-1}}{a_t} \label{eq:ProdSum}
\end{align}
Nyní spočítáme koeficienty $a_0$ a $a_t$:
\begin{align*}
a_0 &= L_t(0) = \sum\limits_{i = 0}^{t} {n \choose i}(q - 1)^i = q^\alpha \\
a_t &= \sum\limits_{i = 0}^{t} (-1)^i (q - 1)^{t - i} \frac{1}{i!}(-1)^{t-i} \frac{1}{(t-i)!} \\
&= \frac{(-1)^t}{t!}\sum\limits_{i = 0}^{t}(q-1)^{t-i} \frac{t!}{i!(t-i)!} \\
&= \frac{(-1)^t}{t!}\bigl((q - 1) + 1\bigr)^t
\end{align*}
Pro poslední rovnost jsme použili binomickou větu. Po dosazení do rovnice~\ref{eq:ProdRoot} dostaneme rovnost pro součin kořenů Lloydova polynomu
\begin{align*}
\prod\limits_{i = 1}^{t} \sigma_i = (-1)^t \frac{q^\alpha}{\frac{(-1)^t}{t!}q^t} = t!q^{\alpha-t}.
\end{align*}
Bez důkazu uvádíme
\begin{align*}
a_{t-1} = - \frac{(-q)^t}{t!}\Bigl(\frac{t(t+1)}{2} + \frac{t(n-t)(q - 1)}{q}\Bigr).
\end{align*}
Po dosazení do rovnice~\ref{eq:ProdSum} dostaneme dokazovanou rovnost pro součet kořenů.
\qed

\lm $2 \sigma_1 \leq \sigma_t$

\dk Definujme si funkci $f(x) = k \Leftrightarrow x = p^hk$, kde pro $p$ platí $q = p^r$ a $p$ je nesoudělné s $k$. Aplikujme $f$ na součin kořenů:
\begin{align*}
f(\sigma_1)f(\sigma_2) \dots f(\sigma_t) &= f(\sigma_1\sigma_2 \dots \sigma_t) =\\
&= f(t!q^{a-t}) = f(t!) \leq t!
\end{align*}

Uvažme nyní 2 možnosti:
\begin{enumerate}
\item Nechť existují $i \neq j$ takové, že $f(\sigma_i) = f(\sigma_j) = k$, pak:
\begin{align*}
\sigma_i &= p^{h_i}k \\
\sigma_j &= p^{h_j}k \\
\end{align*}
Bez újmy na obecnosti platí $\sigma_i < \sigma_j$ a pak tedy $h_i < h_j$ a $p\sigma_i \leq \sigma_j$. Když všechny nerovnosti dáme dohromady, dostaneme požadovaný výsledek
\begin{align*}
\sigma_t \geq \sigma_j \geq p\sigma_i \geq 2\sigma_i \geq 2\sigma_1.
\end{align*}
\item Nechť jsou tedy všechny $f(\sigma_i)$ různé. Jelikož je jejich součin menší než $t!$, pak se mezi $f(\sigma_1),\dots ,f(\sigma_t)$ vyskytují všechna čísla $1,\dots,t$. Jelikož $t \geq 3$ a $p$ je nesoudělné se všemi čísly $1,\dots,t$, tak $p > 3$. Evidentně musí existovat $i,j$ taková, že:
\begin{align*}
\sigma_i &= p^{h_i} \\
\sigma_j &= 2p^{h_j}
\end{align*}
Rozebereme 2 možnosti:
\begin{enumerate}
\item Nechť $h_j \geq h_i$, pak $\sigma_t \geq \sigma_j = 2p^{h_j} \geq 2p^{h_i} = 2\sigma_i \geq 2\sigma_1$
\item Nechť $h_i > h_j$, pak $\sigma_t \geq \sigma_i = p^{h_i} \geq p^{h_j + 1} = \frac{p}{2}\sigma_j \geq 2\sigma_j \geq 2\sigma_1$
\end{enumerate}
\end{enumerate}
\qed

\lm $\sigma_1\sigma_t \leq \frac{8}{9}(\frac{\sigma_1 + \sigma_t}{2})^2$

\dk Celou nerovnost vynásobíme $\sigma^2_1$,
\begin{align*}
\frac{\sigma_t}{\sigma_1} \leq \frac{8}{9}\Bigl(\frac{1 + \frac{\sigma_1}{\sigma_t}}{2}\Bigr)^2.
\end{align*}
Provedeme substituci $x = \frac{\sigma_t}{\sigma_1}$,
\begin{align*}
x \leq \frac{8}{9}\Bigl(\frac{1 + x}{2}\Bigr)^2.
\end{align*}
Po elementárních úpravách dostaneme
\begin{align*}
0 \leq \Bigl(x - \frac{1}{2}\Bigr)\Bigl(x - 2\Bigr).
\end{align*}
Což platí, protože z předchozího lemmatu víme, že $x \geq 2$. \qed


\lm $\prod\limits_{i = 1}^t \sigma_i \geq \frac{n^t (q-1)^t}{q^t}\bigl(1 - \frac{t(t-1)}{2n}\bigr)$

\dk Víme, že
\begin{align*}
\prod\limits_{i = 1}^t \sigma_i = t!q^{\alpha-t}.
\end{align*}
Pravou stranu následně upravíme:
\begin{align*}
\frac{t!}{q^t}q^\alpha &= \frac{t!}{q^t}\sum\limits_{i = 0}^{t}(q - 1)^i{n \choose i} \\
&\geq \frac{t!}{q^t} (q - 1)^t \frac{n(n-1)\dots(n-t+1)}{t!}  \\
&= \frac{(q-1)^t}{q^t} n^t \Bigl(1 - \frac{1}{n}\Bigr)\Bigl(1 - \frac{2}{n}\Bigr)\dots\Bigl(1 - \frac{t-1}{n}\Bigr)
\end{align*}
Nyní použijeme vzoreček, který platí pro $x_1,\dots,x_k \in (0,1)$
\begin{align*}
\prod\limits_{i=1}^{k} (1 - x_i) \geq 1 - \sum\limits_{i=1}^{k} x_i.
\end{align*}
Po aplikaci na $(1 - \frac{1}{n})(1 - \frac{2}{n})\dots(1 - \frac{t-1}{n})$, dostaneme dokazovaný odhad:
\begin{align*}
\frac{t!}{q^t}q^\alpha &\geq \frac{n^t (q-1)^t}{q^t}\Bigl(1 - \sum\limits_{i=1}^{t-1} \frac{i}{n}\Bigr) \\
&\geq \frac{n^t (q-1)^t}{q^t}\Bigl(1 - \frac{t(t-1)}{2n}\Bigr) 
\end{align*}
\qed

\lm $\prod\limits_{i = 1}^t \sigma_i \leq \frac{8}{9}\frac{n^t(q-1)^t}{q^t}$

\dk Pro důkaz použijeme již dokázanou nerovnost $\sigma_1\sigma_t \leq \frac{8}{9}(\frac{\sigma_1+\sigma_t}{2})^2$ a nerovnost mezi aritmetickým a geometrickým průměrem
\begin{align*}
\Bigl(\prod\limits_{i=1}^k x_i \Bigr)^{\frac{1}{k}} \leq \frac{\sum\limits_{i=1}^k x_i}{k}.
\end{align*}
Odhadněme tedy součin kořenů:
\begin{align*}
(\sigma_1\sigma_t)(\sigma_2\sigma_3\dots\sigma_{t-1}) &\leq \frac{8}{9}\Bigl(\frac{\sigma_1+\sigma_t}{2}\Bigr)^2\Bigl(\frac{\sigma_2 + \dots + \sigma_{t-1}}{t-2}\Bigr)^{t-2} \\
&\leq \frac{8}{9} \Bigl(\frac{2\frac{\sigma_1 + \sigma_t}{2} + (t-2)\frac{\sigma_2 + \dots + \sigma_{t-1}}{t-2}}{t}\Bigr)^t \\
&=\frac{8}{9}\Bigl(\frac{\sigma_1 + \dots + \sigma_t}{t}\Bigr)^t
\end{align*}
Po dosazení již dokázaného vzorečku pro součet kořenů dostaneme odhad
\begin{align*}
\prod\limits_{i = 1}^{t} \sigma_i \leq \Bigl(\frac{(n-t)(q-1)}{q} + \frac{t+1}{2}\Bigr)^t.
\end{align*}
Abychom dokázali lemma, potřebujeme tedy dokázat, že
\begin{align*}
\frac{(n-t)(q-1)}{q} + \frac{t+1}{2} \leq \frac{n(q-1)}{q}.
\end{align*}
Po několika elementárních úpravách dostaneme nerovnost $6t + 3q \leq 3tq$, která platí, protože $6t \leq 2tq$ (kvůli předpokladu $q \geq 3$) a $3q \leq tq$ (kvůli předpokladu $t \geq 3$).
\qed

\lm $n \leq \frac{9}{2} t(t-1)$

\dk Nerovnost vyplývá okamžitě z předchozích 2 lemmat.\qed

\lm $n \geq q^{\lfloor \frac{t}{2} \rfloor}$

\dk Nejprve trochu počítání:
\begin{align*}
\prod\limits_{i = 1}^t (\sigma_i - 1) &= (-1)^t \frac{a_t}{a_t} \prod\limits_{i = 1}^t (1 - \sigma_i) \\
&= (-1)^t \frac{L_t(1)}{a_t} \\
&= \Bigl(\frac{q-1}{q}\Bigr)^t (n-1)(n-2)\dots(n-t)
\end{align*}

Jelikož jsou kořeny Lloydova polynomu celá čísla, celý součin je také celé číslo a tedy $p^{rt} = q^t$ musí dělit součin $\pi = (n-1)(n-2)\dots(n-t)$. Pokud bychom vyjádřili číslo $\pi$ pomocí prvočíselného rozkladu, tak $rt$ vyjadřuje počet výskytů prvočísla $p$ v tomto rozkladu. Pokusme se tedy $rt$ nějak odhadnout. Nechť $ N_t = \{n-1,\dots,n-t\}$ a $h$ je takové číslo, že $p^h$ dělí nějaké číslo z $N_t$ a $p^{h+1}$ nedělí žádné z čísel z $N_t$. Nechť $k$ je takové, že $k = fp^h \in N_t$. Když k číslo $k$ budeme přičítat či odčítat číslo $p$ dostaneme čísla dělitelné $p$, tedy $k + p, k - p, k + 2p, k - 2p$ atd. Takovýchto čísel z $N_t$ je tedy $\lfloor \frac{t}{p} \rfloor$. Obecně když budeme přičítat odčítat mocninu $p^i$, dostaneme čísla dělitelné $p^i$ a těch je $\lfloor \frac{t}{p^i} \rfloor$ v množině $N_t$. Počet výskytů $p$ v rozkladu čísla $\pi$ můžeme tedy odhadnout
\[
rt \leq h + \Bigl\lfloor \frac{t}{p} \Bigr\rfloor + \Bigl\lfloor \frac{t}{p^2} \Bigr\rfloor + \Bigl\lfloor \frac{t}{p^3} \Bigr\rfloor + \dots
\]
To dále můžeme upravit:
\begin{align*}
h &\geq rt - \sum\limits_{i=1}^\infty \Bigl\lfloor \frac{t}{p^i} \Bigr\rfloor 
 \geq rt - \frac{t}{p} \Bigl(\sum\limits_{i=0}^\infty  \frac{1}{p^i} \Bigr) \\
& = rt - \frac{t}{p}\Bigl(\frac{1}{1-\frac{1}{p}}\Bigr) 
= t \Bigl(r - \frac{1}{p-1} \Bigr) \\
& \geq \frac{rt}{2}
\end{align*}
Poslední nerovnost vychází z toho, že $r - \frac{1}{p-1} \geq \frac{r}{2}$, což se dá snadno ověřit rozborem případů pro $p > 2$ a $p = 2$. Nyní již můžeme odhadnou $n$ a dokázat tak lemma
\[
n > p^h \geq p^{\frac{rt}{2}} \geq q^{\lfloor\frac{t}{2}\rfloor}.
\]
\qed

\lm $t \leq 11, q \leq 27$ a $n \leq 495$.

\dk Když složíme předchozí 2 lemmata dohromady dostaneme nerovnost
\[
\frac{9}{2}t(t-1) \geq n \geq q^{\lfloor\frac{t}{2}\rfloor} \geq 3^{\lfloor\frac{t}{2}\rfloor}.
\]
Z nerovnosti $\frac{9}{2}t(t-1) \geq 3^{\lfloor\frac{t}{2}\rfloor}$ dostaneme odhad $t \leq 11$. Následně pak dosadíme za $t$ a dostaneme, že $n \leq 495$. Při dosazení $t=3$ (nejmenší možná hodnota $t$, kdy $q$ dosahuje nejvyšší hodnoty) dostaneme odhad $q \leq 27$. \qed

Počítačem bylo ověřeno, že pro hodnoty $3 \leq t \leq 11, 3 \leq q \leq 27$ a $n \leq 495$ neexistují žádné perfektní kódy, kdy $q$ je mocnina prvočísla. Charakterizace perfektních kódů nad abecedou, která má velikost mocninu prvočísla, je tedy hotová.

Pro zajímavost uvedeme, že pro $q$, které není mocninou prvočísla, neexistují perfektní kódy pro $t \geq 3$ a pro $t = 1,2$ se to neví. Pro parametry, pro které existují perfektní kódy, existují i jiné perfektní kódy než Hammingovy a Golayovi.